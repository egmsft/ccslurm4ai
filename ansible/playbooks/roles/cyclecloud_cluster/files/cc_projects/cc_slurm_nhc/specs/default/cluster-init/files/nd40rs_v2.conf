# Config file from: https://github.com/Azure/azurehpc-health-checks/blob/main/conf/nd40rs_v2.conf
# NHC Configuration File
#
# Lines are in the form "<hostmask>||<check>"
# Hostmask is a glob, /regexp/, or {noderange}
# Comments begin with '#'
#
# This file was automatically generated by nhc-genconf
# Thu Dec 21 16:51:37 UTC 2023
#

#######################################################################
###
### NHC Configuration Variables
###
# * || export MARK_OFFLINE=1 NHC_CHECK_ALL=0

#######################################################################
###
### Filesystem checks
###
 * || check_fs_mount_rw -t "sysfs" -s "sysfs" -f "/sys"
 * || check_fs_mount_rw -t "proc" -s "proc" -f "/proc"
 * || check_fs_mount_rw -t "devtmpfs" -s "devtmpfs" -f "/dev"
 * || check_fs_mount_rw -t "devpts" -s "devpts" -f "/dev/pts"
 * || check_fs_mount_rw -t "tmpfs" -s "tmpfs" -f "/run"
 * || check_fs_mount_rw -t "ext4" -s "/dev/root" -f "/"
 * || check_fs_mount_rw -t "securityfs" -s "securityfs" -f "/sys/kernel/security"
 * || check_fs_mount_rw -t "tmpfs" -s "tmpfs" -f "/dev/shm"
 * || check_fs_mount_rw -t "tmpfs" -s "tmpfs" -f "/run/lock"
 * || check_fs_mount_rw -t "pstore" -s "pstore" -f "/sys/fs/pstore"
 * || check_fs_mount_rw -t "efivarfs" -s "efivarfs" -f "/sys/firmware/efi/efivars"
 * || check_fs_mount_rw -t "hugetlbfs" -s "hugetlbfs" -f "/dev/hugepages"
 * || check_fs_mount_rw -t "mqueue" -s "mqueue" -f "/dev/mqueue"
 * || check_fs_mount_rw -t "debugfs" -s "debugfs" -f "/sys/kernel/debug"
 * || check_fs_mount_rw -t "vfat" -s "/dev/sda15" -f "/boot/efi"
 * || check_fs_mount_rw -t "fusectl" -s "fusectl" -f "/sys/fs/fuse/connections"
 * || check_fs_mount_rw -t "configfs" -s "configfs" -f "/sys/kernel/config"
 * || check_fs_mount_rw -t "ext4" -s "/dev/sdb1" -f "/mnt"
 * || check_fs_mount_rw -t "tracefs" -s "tracefs" -f "/sys/kernel/debug/tracing"
 * || check_fs_mount_rw -t "nfs4" -s "*:/sched" -f "/sched"
 * || check_fs_mount_rw -t "nfs*" -s "*:/*" -f "/shared"
  * || check_fs_used /dev 90%
 * || check_fs_used / 90%
 * || check_fs_used /boot/efi 90%
 * || check_fs_used /mnt 90%
 * || check_fs_used /data 90%
 * || check_fs_used /sched 90%
 * || check_fs_used /shared 90%
 * || check_fs_iused /dev 98%
 * || check_fs_iused / 100%
 * || check_fs_iused /mnt 98%
 * || check_fs_iused /data 98%
 * || check_fs_iused /sched 100%
 * || check_fs_iused /shared 98%
 
#######################################################################
###
### Hardware checks
###
 * || check_hw_cpuinfo 2 40 40
 * || check_hw_physmem 693505424kB 693505424kB 3%
 * || check_hw_swap 0kB 0kB 3%
 * || check_hw_ib 100 mlx5_ib0:1
 * || check_hw_eth lo
 * || check_hw_eth eth0
 * || check_hw_eth ib0
 

########################################################
####
#### GPU checks
####
 * || check_gpu_ecc
 * || check_gpu_count 8
 * || check_gpu_xid
 * || check_nvsmi_healthmon
 * || check_gpu_clock_throttling
 #* || check_gpu_bw 10
 #* || check_nvlink_status
 #* || check_nccl_allreduce 110.0 1 $AZ_NHC_ROOT/topofiles/ndv2-topo.xml 8G


#######################################################################
####
#### Additional IB checks
####
# * || check_ib_bw_non_gdr 78 65536
 * || check_ib_link_flapping 6